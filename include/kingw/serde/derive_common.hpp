#pragma once


// Copy-pasted from https://github.com/cbeck88/visit_struct/blob/master/include/visit_struct/visit_struct.hpp
// (Prepended with my own name just to deconflict)
#define KINGW_SERDE_EXPAND(x) x
#define KINGW_SERDE_PP_ARG_N( \
        _1, _2, _3, _4, _5, _6, _7, _8, _9, _10,\
        _11, _12, _13, _14, _15, _16, _17, _18, _19, _20,\
        _21, _22, _23, _24, _25, _26, _27, _28, _29, _30,\
        _31, _32, _33, _34, _35, _36, _37, _38, _39, _40,\
        _41, _42, _43, _44, _45, _46, _47, _48, _49, _50,\
        _51, _52, _53, _54, _55, _56, _57, _58, _59, _60,\
        _61, _62, _63, _64, _65, _66, _67, _68, _69, N, ...) N
#define KINGW_SERDE_PP_NARG(...) KINGW_SERDE_EXPAND(KINGW_SERDE_PP_ARG_N(__VA_ARGS__,  \
        69, 68, 67, 66, 65, 64, 63, 62, 61, 60,  \
        59, 58, 57, 56, 55, 54, 53, 52, 51, 50,  \
        49, 48, 47, 46, 45, 44, 43, 42, 41, 40,  \
        39, 38, 37, 36, 35, 34, 33, 32, 31, 30,  \
        29, 28, 27, 26, 25, 24, 23, 22, 21, 20,  \
        19, 18, 17, 16, 15, 14, 13, 12, 11, 10,  \
        9, 8, 7, 6, 5, 4, 3, 2, 1, 0))

/* need extra level to force extra eval */
#define KINGW_SERDE_CONCAT_(a,b) a ## b
#define KINGW_SERDE_CONCAT(a,b) KINGW_SERDE_CONCAT_(a,b)


// Custom: Consume two parameters at a time.
// Generated from the following Python scripts:
//   fn1 = lambda n: ','.join(['_{},_{}'.format(x+1, x+2) for x in range(0,n,2)])
//   fn2 = lambda n: ' '.join(['f(_{}, _{})'.format(x+1, x+2) for x in range(0,n,2)])
//   for x in range(0, 10, 2): print('#define KINGW_SERDE_APPLYF{}(f,{}) {}'.format(x, fn1(x), fn2(x)))
#define KINGW_SERDE_APPLYF0(f)
#define KINGW_SERDE_APPLYF2(f,_1,_2) f(_1, _2)
#define KINGW_SERDE_APPLYF4(f,_1,_2,_3,_4) f(_1, _2) f(_3, _4)
#define KINGW_SERDE_APPLYF6(f,_1,_2,_3,_4,_5,_6) f(_1, _2) f(_3, _4) f(_5, _6)
#define KINGW_SERDE_APPLYF8(f,_1,_2,_3,_4,_5,_6,_7,_8) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8)
#define KINGW_SERDE_APPLYF10(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10)
#define KINGW_SERDE_APPLYF12(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12)
#define KINGW_SERDE_APPLYF14(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14)
#define KINGW_SERDE_APPLYF16(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16)
#define KINGW_SERDE_APPLYF18(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18)
#define KINGW_SERDE_APPLYF20(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18) f(_19, _20)
#define KINGW_SERDE_APPLYF22(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20,_21,_22) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18) f(_19, _20) f(_21, _22)
#define KINGW_SERDE_APPLYF24(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20,_21,_22,_23,_24) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18) f(_19, _20) f(_21, _22) f(_23, _24)
#define KINGW_SERDE_APPLYF26(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20,_21,_22,_23,_24,_25,_26) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18) f(_19, _20) f(_21, _22) f(_23, _24) f(_25, _26)
#define KINGW_SERDE_APPLYF28(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20,_21,_22,_23,_24,_25,_26,_27,_28) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18) f(_19, _20) f(_21, _22) f(_23, _24) f(_25, _26) f(_27, _28)
#define KINGW_SERDE_APPLYF30(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20,_21,_22,_23,_24,_25,_26,_27,_28,_29,_30) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18) f(_19, _20) f(_21, _22) f(_23, _24) f(_25, _26) f(_27, _28) f(_29, _30)
#define KINGW_SERDE_APPLYF32(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20,_21,_22,_23,_24,_25,_26,_27,_28,_29,_30,_31,_32) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18) f(_19, _20) f(_21, _22) f(_23, _24) f(_25, _26) f(_27, _28) f(_29, _30) f(_31, _32)
#define KINGW_SERDE_APPLYF34(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20,_21,_22,_23,_24,_25,_26,_27,_28,_29,_30,_31,_32,_33,_34) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18) f(_19, _20) f(_21, _22) f(_23, _24) f(_25, _26) f(_27, _28) f(_29, _30) f(_31, _32) f(_33, _34)
#define KINGW_SERDE_APPLYF36(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20,_21,_22,_23,_24,_25,_26,_27,_28,_29,_30,_31,_32,_33,_34,_35,_36) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18) f(_19, _20) f(_21, _22) f(_23, _24) f(_25, _26) f(_27, _28) f(_29, _30) f(_31, _32) f(_33, _34) f(_35, _36)
#define KINGW_SERDE_APPLYF38(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20,_21,_22,_23,_24,_25,_26,_27,_28,_29,_30,_31,_32,_33,_34,_35,_36,_37,_38) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18) f(_19, _20) f(_21, _22) f(_23, _24) f(_25, _26) f(_27, _28) f(_29, _30) f(_31, _32) f(_33, _34) f(_35, _36) f(_37, _38)
#define KINGW_SERDE_APPLYF40(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20,_21,_22,_23,_24,_25,_26,_27,_28,_29,_30,_31,_32,_33,_34,_35,_36,_37,_38,_39,_40) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18) f(_19, _20) f(_21, _22) f(_23, _24) f(_25, _26) f(_27, _28) f(_29, _30) f(_31, _32) f(_33, _34) f(_35, _36) f(_37, _38) f(_39, _40)
#define KINGW_SERDE_APPLYF42(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20,_21,_22,_23,_24,_25,_26,_27,_28,_29,_30,_31,_32,_33,_34,_35,_36,_37,_38,_39,_40,_41,_42) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18) f(_19, _20) f(_21, _22) f(_23, _24) f(_25, _26) f(_27, _28) f(_29, _30) f(_31, _32) f(_33, _34) f(_35, _36) f(_37, _38) f(_39, _40) f(_41, _42)
#define KINGW_SERDE_APPLYF44(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20,_21,_22,_23,_24,_25,_26,_27,_28,_29,_30,_31,_32,_33,_34,_35,_36,_37,_38,_39,_40,_41,_42,_43,_44) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18) f(_19, _20) f(_21, _22) f(_23, _24) f(_25, _26) f(_27, _28) f(_29, _30) f(_31, _32) f(_33, _34) f(_35, _36) f(_37, _38) f(_39, _40) f(_41, _42) f(_43, _44)
#define KINGW_SERDE_APPLYF46(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20,_21,_22,_23,_24,_25,_26,_27,_28,_29,_30,_31,_32,_33,_34,_35,_36,_37,_38,_39,_40,_41,_42,_43,_44,_45,_46) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18) f(_19, _20) f(_21, _22) f(_23, _24) f(_25, _26) f(_27, _28) f(_29, _30) f(_31, _32) f(_33, _34) f(_35, _36) f(_37, _38) f(_39, _40) f(_41, _42) f(_43, _44) f(_45, _46)
#define KINGW_SERDE_APPLYF48(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20,_21,_22,_23,_24,_25,_26,_27,_28,_29,_30,_31,_32,_33,_34,_35,_36,_37,_38,_39,_40,_41,_42,_43,_44,_45,_46,_47,_48) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18) f(_19, _20) f(_21, _22) f(_23, _24) f(_25, _26) f(_27, _28) f(_29, _30) f(_31, _32) f(_33, _34) f(_35, _36) f(_37, _38) f(_39, _40) f(_41, _42) f(_43, _44) f(_45, _46) f(_47, _48)
#define KINGW_SERDE_APPLYF50(f,_1,_2,_3,_4,_5,_6,_7,_8,_9,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_20,_21,_22,_23,_24,_25,_26,_27,_28,_29,_30,_31,_32,_33,_34,_35,_36,_37,_38,_39,_40,_41,_42,_43,_44,_45,_46,_47,_48,_49,_50) f(_1, _2) f(_3, _4) f(_5, _6) f(_7, _8) f(_9, _10) f(_11, _12) f(_13, _14) f(_15, _16) f(_17, _18) f(_19, _20) f(_21, _22) f(_23, _24) f(_25, _26) f(_27, _28) f(_29, _30) f(_31, _32) f(_33, _34) f(_35, _36) f(_37, _38) f(_39, _40) f(_41, _42) f(_43, _44) f(_45, _46) f(_47, _48) f(_49, _50)

#define KINGW_SERDE_APPLY_F_(M, ...) KINGW_SERDE_EXPAND(M(__VA_ARGS__))
#define KINGW_SERDE_PP_MAP(f, ...) KINGW_SERDE_EXPAND(KINGW_SERDE_APPLY_F_(KINGW_SERDE_CONCAT(KINGW_SERDE_APPLYF, KINGW_SERDE_PP_NARG(__VA_ARGS__)), f, __VA_ARGS__))
